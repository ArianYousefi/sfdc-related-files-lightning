<!--
    Developed by Doug Ayers (douglascayers.com)
 -->
<aura:component controller="CF_ChildFilesController" implements="flexipage:availableForRecordHome,force:hasRecordId,force:hasSObjectName">

    <aura:attribute name="sObjectDescribe"
                    type="Object"
                    description="SObject and Field describe info"/>

    <aura:attribute name="sObjectName"
                    type="String"
                    description="The object name of the record to be displayed. Provided by force:hasSObjectName interface."/>

    <aura:attribute name="recordId"
                    type="String"
                    description="The ID of the record to be displayed. Provided by force:hasRecordId interface."/>

    <aura:attribute name="record"
                    type="Object"
                    description="The record object to be displayed."/>

    <aura:attribute name="childRelationshipNames"
                    type="String"
                    description="Comma-separated list of child relationship API names provided by design attributes in App Builder."/>

    <aura:attribute name="childRelationshipFiles"
                    type="Object[]"
                    description=""/>

    <aura:attribute name="selectedIndex"
                    type="Integer"
                    default="0"
                    description=""/>

    <aura:attribute name="selectedFiles"
                    type="Object[]"
                    description=""/>

    <aura:attribute name="selectedRelationship"
                    type="Object"
                    description=""/>

    <!-- Events -->

    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>

    <!-- Markup -->

    <lightning:spinner aura:id="spinner" variant="brand"/>

    <div class="slds-grid">

        <div class="slds-col slds-size_1-of-4 slds-m-right_small slds-p-right_small slds-border_right">

            <nav class="slds-nav-vertical" aria-label="Relationships">
                <div class="slds-nav-vertical__section">
                    <h2 id="entity-header" class="slds-nav-vertical__title slds-text-title_caps">Relationships</h2>
                    <ul>
                        <aura:iteration var="relationship" items="{!v.childRelationshipFiles}" indexVar="index">
                            <li class="{! 'slds-nav-vertical__item ' + if( relationship.selected, 'slds-is-active', '' )}">
                                <a href="javascript:void(0);"
                                   class="slds-nav-vertical__action"
                                   title="{!relationship.describe.objectLabelPlural + ' (' + relationship.name + ')'}"
                                   aria-describedby="entity-header"
                                   data-index="{!index}"
                                   onclick="{!c.handleChildRelationshipClick}">

                                    {!relationship.describe.objectLabelPlural}

                                    <span class="{! 'slds-badge slds-col_bump-left ' + if( greaterthan( relationship.files.length, 0 ), 'slds-theme_success', '' )}">
                                        <span class="slds-assistive-text">:</span>
                                        {!relationship.files.length}
                                        <span class="slds-assistive-text">Files</span>
                                    </span>

                                </a>
                            </li>
                        </aura:iteration>
                    </ul>
                </div>
            </nav>

        </div>

        <div class="slds-col slds-size_3-of-4">

            <table class="slds-table slds-table_bordered">
                <thead>
                    <tr class="slds-text-title_caps">
                        <th scope="col" class="slds-cell-wrap">
                            <div title="Title">Title</div>
                        </th>
                        <th scope="col" class="slds-cell-wrap">
                            <div title="Owner">Owner</div>
                        </th>
                        <th scope="col" class="slds-cell-wrap">
                            <div title="Last Modified">Last Modified</div>
                        </th>
                        <th scope="col" class="slds-cell-wrap">
                            <div title="Size">Size</div>
                        </th>
                    </tr>
                </thead>
                <tbody>

                    <aura:if isTrue="{! empty( v.selectedFiles ) }">
                        <tr>
                            <th colspan="4">
                                <div class="slds-text-align_center">No items to display.</div>
                            </th>
                        </tr>
                    </aura:if>

                    <aura:iteration var="file" items="{!v.selectedFiles}">
                        <tr>
                            <th scope="row" data-label="{!file.Title}" class="slds-cell-wrap">
                                <div title="{!file.Title}">
                                    <a href="javascript:void(0);"
                                       data-fileId="{!file.ContentDocumentId}"
                                       onclick="{!c.handleFileClick}">
                                        {!file.Title}
                                    </a>
                                </div>
                            </th>
                            <td data-label="Owner" class="slds-cell-wrap">
                                <div title="{!file.OwnerName}">
                                    <a href="javascript:void(0);"
                                       data-userId="{!file.OwnerId}"
                                       onclick="{!c.handleUserClick}">
                                        {!file.OwnerName}
                                    </a>
                                </div>
                            </td>
                            <td data-label="Last Modified" class="slds-cell-wrap">
                                <div title="{!file.LastModifiedDate}">
                                    <lightning:formattedDateTime value="{!file.LastModifiedDateTimestamp}" year="numeric" month="numeric" day="numeric" hour="numeric" minute="numeric"/>
								</div>
                            </td>
                            <td data-label="Size" class="slds-cell-wrap">
                                <div title="{!file.HumanReadableContentSize}">{!file.HumanReadableContentSize}</div>
                            </td>
                        </tr>
                    </aura:iteration>

                </tbody>
            </table>

        </div>

    </div>

</aura:component>